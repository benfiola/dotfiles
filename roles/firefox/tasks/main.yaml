---
- tags: [graphical, firefox]
  block:
    - when: not (darwin or linux)
      block:
        - name: unimplemented
          benfiola.dotfiles.empty: {}

    - when: darwin
      block:
        - name: brew install homebrew/cask/firefox
          community.general.homebrew_cask:
            name: homebrew/cask/firefox
            path: "{{brew_path}}"

        - name: install enterprise profile
          ansible.builtin.unarchive:
            dest: /Applications/Firefox.app/Contents/Resources
            src: "{{dotfiles_path}}/roles/firefox/files/enterprise_policy.zip"

        - name: unquarantine firefox
          when: darwin
          ansible.builtin.command:
            cmd: xattr -d com.apple.quarantine /Applications/Firefox.app
          changed_when: false
          failed_when: false

    - when: linux
      block:
        - name: flatpak install bitwarden
          become: true
          community.general.flatpak:
            name: org.mozilla.firefox

        - name: create enterprise profile directory
          ansible.builtin.file:
            path: "{{user.home}}/.var/app/org.mozilla.firefox/config/firefox"
            state: directory
            recurse: true

        - name: install enterprise profile
          ansible.builtin.unarchive:
            dest: "{{user.home}}/.var/app/org.mozilla.firefox/config/firefox"
            src: "{{dotfiles_path}}/roles/firefox/files/enterprise_policy.zip"

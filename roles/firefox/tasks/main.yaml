---
- tags: [graphical, firefox]
  block:
    - when: not (darwin or archlinux)
      block:
        - name: unimplemented
          benfiola.dotfiles.empty: {}

    - when: darwin
      block:
        - name: brew install homebrew/cask/firefox
          community.general.homebrew_cask:
            name: homebrew/cask/firefox
            path: "{{brew_path}}"

        - name: install enterprise profile
          ansible.builtin.include_role:
            role: benfiola.dotfiles.firefox
            tasks_from: install-policy.yaml
          vars:
            policy_path: /Applications/Firefox.app/Contents/Resources

        - name: unquarantine firefox
          ansible.builtin.command:
            cmd: xattr -d com.apple.quarantine /Applications/Firefox.app
          changed_when: false
          failed_when: false

    - when: archlinux
      block:
        - name: pacman install firefox
          become: true
          community.general.pacman:
            name:
              - firefox

        - name: install enterprise policy
          ansible.builtin.include_role:
            role: benfiola.dotfiles.firefox
            tasks_from: install-policy.yaml
          vars:
            policy_path: /usr/lib/firefox
